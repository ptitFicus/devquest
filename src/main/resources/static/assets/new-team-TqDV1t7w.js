import{r as c,u as b,R as x,M as y,a as v,j as n}from"./index-A7h8lev9.js";import{T as C,a as S}from"./TeamDetails-PHUsJs85.js";function M({availableMembers:l}){const[o,i]=c.useState(""),[a,r]=c.useState([]),h=b({from:"/new-team"}),e=x.useSearch();console.log("currentTeam",e);const{refreshMoney:p,money:g}=c.useContext(y),[d,m]=c.useState(!1),j=v();return n.jsxs("div",{children:[n.jsx("h1",{children:e!=null&&e.name?`√âdition du groupe ${e==null?void 0:e.name}`:"Cr√©ation d'un nouveau groupe"}),n.jsx("h2",{children:"Membres du groupe"}),n.jsx(C,{actions:[],team:{name:o,heros:((e==null?void 0:e.heros)??[]).concat(a)},memberActions:[t=>{var s;return console.log("currentTeam",e),console.log("member",t),(s=e==null?void 0:e.heros)!=null&&s.find(u=>u.name===t.name)?{}:{name:`Renvoyer ${t.name}`,callback:()=>{r(u=>u.filter(f=>f.name!==t.name))}}}]}),n.jsxs("label",{style:{display:"block"},children:["Nom du groupe",n.jsx("input",{type:"text",disabled:!!(e!=null&&e.name),value:e?e.name:o,onChange:t=>{var s;return i((s=t==null?void 0:t.target)==null?void 0:s.value)}})]}),n.jsx("button",{onClick:()=>{fetch("/api/groupe",{method:"POST",body:JSON.stringify({name:(e==null?void 0:e.name)??o,heros:((e==null?void 0:e.heros)??[]).concat(a)}),headers:{"Content-Type":"application/json"}}).then(()=>p()).then(()=>h({to:"/"}))},children:e!=null&&e.name?"Mettre √† jour le groupe":"Cr√©er le groupe"}),n.jsx("h2",{children:"Available members"}),!d&&n.jsx("button",{onClick:()=>m(!0),children:"Invoquer un nouveau h√©ro"}),d&&n.jsx(k,{onSubmit:t=>{console.log("coucou",t),fetch("/api/heros",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(()=>j.invalidate()).then(()=>m(!1))}}),l.filter(t=>!a.find(s=>s.name===t.name)&&!((e==null?void 0:e.heros)??[]).find(s=>s.name===t.name)).map(t=>n.jsx("div",{style:{margin:"4px"},children:n.jsx(S,{details:t,light:!1,actions:((e==null?void 0:e.heros)??[]).concat(a).length<4?[{name:`Recruter ${t.name} (1000üí∞)`,callback:()=>r(s=>[...s,t]),disabled:g-a.length*1e3<1e3}]:[],achievements:!0})}))]})}function k(l){return n.jsxs("form",{onSubmit:o=>{o.preventDefault();const i=o.target,a=i.name.value,r=i.classe.value,h=i.exploits.value.split(`
`);l==null||l.onSubmit({name:a,role:r,achievements:h})},style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[n.jsxs("label",{children:["Name¬†",n.jsx("input",{name:"name",type:"text"})]}),n.jsxs("label",{children:["Classe¬†",n.jsx("select",{name:"classe",children:["archer","dwarf","elf","group","king","knight","necromancer","shaman","wizard"].map(o=>n.jsx("option",{children:o}))})]}),n.jsxs("label",{children:["Exploits (1 exploit / ligne)",n.jsx("br",{}),n.jsx("textarea",{name:"exploits",style:{width:500,height:80}})]}),n.jsx("button",{type:"submit",children:"Cr√©er le h√©ro"})]})}const w=function(){const o=x.useLoaderData();return n.jsx(M,{availableMembers:o})};export{M as TeamEditor,w as component};
